<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kompozisyon Asistanı</title>
    
    <!-- React ve ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel (JSX'i tarayıcıda çalıştırmak için) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Animasyonlar */
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // --- ICONS (SVG Components) ---
        const Icons = {
            FileText: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>,
            Upload: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            CheckCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
            AlertCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
            Loader2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
            Award: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>,
            ChevronDown: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"/></svg>,
            ChevronUp: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="18 15 12 9 6 15"/></svg>,
            Trash2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            Plus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></svg>
        };

        // --- MAIN APP COMPONENT ---
        function App() {
            const [students, setStudents] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [activeTab, setActiveTab] = useState('upload'); // 'upload' or 'list'
            
            // Form states
            const [studentName, setStudentName] = useState('');
            const [essayTopic, setEssayTopic] = useState('');
            const [selectedFile, setSelectedFile] = useState(null);
            const [previewUrl, setPreviewUrl] = useState(null);

            const fileInputRef = useRef(null);

            // Gemini API Configuration
            const apiKey = ""; // API anahtarınızı buraya ekleyebilirsiniz, ancak güvenli bir ortamda environment variable kullanmak daha iyidir.

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    setSelectedFile(file);
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setPreviewUrl(reader.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            const handleAnalyze = async () => {
                if (!studentName || !selectedFile || !essayTopic) {
                    setError("Lütfen öğrenci adı, konu ve bir fotoğraf yükleyiniz.");
                    return;
                }

                setLoading(true);
                setError(null);

                try {
                    const base64Data = previewUrl.split(',')[1];
                    const mimeType = selectedFile.type;

                    const prompt = `
                        Sen uzman bir Türkçe öğretmenisin. Görevin bu el yazısı kağıdını okumak ve değerlendirmek.
                        
                        Öğrenci Adı: ${studentName}
                        Kompozisyon Konusu: ${essayTopic}

                        Lütfen şu adımları izle:
                        1. Görüntüdeki el yazısını OCR (Optik Karakter Tanıma) ile metne çevir.
                        2. Metni şu kriterlere göre 5 üzerinden puanla (Tam sayı ver):
                        - Kriter A: Yazım Kuralları ve Noktalama (0-5 Puan)
                        - Kriter B: Kompozisyon Yapısı (Giriş-Gelişme-Sonuç) (0-5 Puan)
                        - Kriter C: İçeriğe Uygunluk ve Fikir Zenginliği (0-5 Puan)
                        3. Öğrenciye kısa, yapıcı bir geri bildirim yaz.

                        Yanıtı SADECE şu JSON formatında ver (başka bir şey yazma):
                        {
                        "ocrText": "Buraya okunan metin gelecek...",
                        "scores": {
                            "grammar": 0,
                            "structure": 0,
                            "content": 0
                        },
                        "totalScore": 0,
                        "feedback": "Öğrenci için geri bildirim..."
                        }
                    `;

                    const response = await fetch(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                contents: [{
                                    parts: [
                                        { text: prompt },
                                        {
                                            inlineData: {
                                                mimeType: mimeType,
                                                data: base64Data
                                            }
                                        }
                                    ]
                                }],
                                generationConfig: {
                                    responseMimeType: "application/json"
                                }
                            })
                        }
                    );

                    if (!response.ok) throw new Error("Analiz servisine ulaşılamadı. API anahtarınızın doğru olduğundan emin olun.");

                    const result = await response.json();
                    const textResponse = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (!textResponse) throw new Error("Yapay zekadan boş yanıt döndü.");

                    const analysisData = JSON.parse(textResponse);
                    const calculatedTotal = analysisData.scores.grammar + analysisData.scores.structure + analysisData.scores.content;

                    const newStudentEntry = {
                        id: Date.now(),
                        name: studentName,
                        topic: essayTopic,
                        image: previewUrl,
                        ...analysisData,
                        totalScore: calculatedTotal,
                        timestamp: new Date().toLocaleDateString('tr-TR')
                    };

                    setStudents([newStudentEntry, ...students]);
                    setStudentName('');
                    setEssayTopic('');
                    setSelectedFile(null);
                    setPreviewUrl(null);
                    setActiveTab('list');

                } catch (err) {
                    console.error(err);
                    setError("Analiz sırasında bir hata oluştu: " + err.message);
                } finally {
                    setLoading(false);
                }
            };

            const deleteStudent = (id) => {
                setStudents(students.filter(s => s.id !== id));
            };

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-800 pb-20">
                    {/* Header */}
                    <header className="bg-indigo-600 text-white shadow-lg">
                        <div className="container mx-auto px-4 py-6 flex justify-between items-center">
                            <div className="flex items-center space-x-3">
                                <Icons.FileText className="w-8 h-8" />
                                <h1 className="text-2xl font-bold tracking-tight">Kompozisyon Asistanı</h1>
                            </div>
                            <div className="text-indigo-200 text-sm hidden md:block">
                                AI Destekli OCR ve Puanlama Sistemi
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="container mx-auto px-4 py-8">
                        
                        {/* Navigation Tabs */}
                        <div className="flex justify-center mb-8">
                            <div className="bg-white p-1 rounded-xl shadow-sm border border-slate-200 inline-flex">
                                <button
                                    onClick={() => setActiveTab('upload')}
                                    className={`px-6 py-2 rounded-lg text-sm font-medium transition-all flex items-center space-x-2 ${
                                        activeTab === 'upload' 
                                        ? 'bg-indigo-600 text-white shadow-md' 
                                        : 'text-slate-600 hover:bg-slate-50'
                                    }`}
                                >
                                    <Icons.Plus size={16} />
                                    <span>Yeni Analiz</span>
                                </button>
                                <button
                                    onClick={() => setActiveTab('list')}
                                    className={`px-6 py-2 rounded-lg text-sm font-medium transition-all flex items-center space-x-2 ${
                                        activeTab === 'list' 
                                        ? 'bg-indigo-600 text-white shadow-md' 
                                        : 'text-slate-600 hover:bg-slate-50'
                                    }`}
                                >
                                    <Icons.FileText size={16} />
                                    <span>Sonuç Listesi ({students.length})</span>
                                </button>
                            </div>
                        </div>

                        {/* Upload View */}
                        {activeTab === 'upload' && (
                            <div className="max-w-2xl mx-auto fade-in">
                                <div className="bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden">
                                    <div className="p-6 border-b border-slate-100 bg-slate-50/50">
                                        <h2 className="text-lg font-semibold text-slate-800">Yeni Kompozisyon Yükle</h2>
                                        <p className="text-slate-500 text-sm mt-1">Sistem el yazısını okuyacak ve otomatik puanlayacaktır.</p>
                                    </div>
                                    
                                    <div className="p-8 space-y-6">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Öğrenci Adı Soyadı</label>
                                            <input 
                                                type="text" 
                                                value={studentName}
                                                onChange={(e) => setStudentName(e.target.value)}
                                                placeholder="Örn: Ahmet Yılmaz"
                                                className="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Kompozisyon Konusu</label>
                                            <input 
                                                type="text" 
                                                value={essayTopic}
                                                onChange={(e) => setEssayTopic(e.target.value)}
                                                placeholder="Örn: Teknoloji ve Yalnızlık"
                                                className="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Kağıt Fotoğrafı</label>
                                            <div 
                                                onClick={() => fileInputRef.current?.click()}
                                                className={`border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all ${
                                                    previewUrl ? 'border-indigo-300 bg-indigo-50' : 'border-slate-300 hover:border-indigo-400 hover:bg-slate-50'
                                                }`}
                                            >
                                                <input 
                                                    type="file" 
                                                    ref={fileInputRef}
                                                    onChange={handleFileChange}
                                                    accept="image/*"
                                                    className="hidden"
                                                />
                                                
                                                {previewUrl ? (
                                                    <div className="relative">
                                                        <img src={previewUrl} alt="Önizleme" className="max-h-64 mx-auto rounded shadow-sm" />
                                                        <div className="mt-4 text-indigo-600 font-medium flex items-center justify-center">
                                                            <Icons.CheckCircle size={18} className="mr-2" />
                                                            Fotoğraf Seçildi
                                                        </div>
                                                        <p className="text-xs text-slate-500 mt-1">Değiştirmek için tıklayın</p>
                                                    </div>
                                                ) : (
                                                    <div className="py-4">
                                                        <Icons.Upload className="w-12 h-12 text-slate-400 mx-auto mb-4" />
                                                        <p className="text-slate-600 font-medium">Fotoğraf yüklemek için tıklayın</p>
                                                        <p className="text-slate-400 text-sm mt-1">veya sürükleyip bırakın (PNG, JPG)</p>
                                                    </div>
                                                )}
                                            </div>
                                        </div>

                                        {error && (
                                            <div className="bg-red-50 text-red-600 p-4 rounded-lg flex items-start text-sm">
                                                <Icons.AlertCircle className="w-5 h-5 mr-2 flex-shrink-0" />
                                                {error}
                                            </div>
                                        )}

                                        <button 
                                            onClick={handleAnalyze}
                                            disabled={loading}
                                            className={`w-full py-4 rounded-xl text-white font-semibold text-lg shadow-lg transition-all transform active:scale-[0.98] ${
                                                loading 
                                                ? 'bg-slate-400 cursor-not-allowed' 
                                                : 'bg-indigo-600 hover:bg-indigo-700 hover:shadow-indigo-200'
                                            }`}
                                        >
                                            {loading ? (
                                                <div className="flex items-center justify-center space-x-2">
                                                    <Icons.Loader2 className="animate-spin" />
                                                    <span>Analiz Ediliyor...</span>
                                                </div>
                                            ) : (
                                                <div className="flex items-center justify-center space-x-2">
                                                    <Icons.Award className="w-5 h-5" />
                                                    <span>Analiz Et ve Puanla</span>
                                                </div>
                                            )}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Results List View */}
                        {activeTab === 'list' && (
                            <div className="max-w-5xl mx-auto space-y-6 fade-in">
                                {students.length === 0 ? (
                                    <div className="text-center py-20 bg-white rounded-2xl border border-dashed border-slate-300">
                                        <Icons.FileText className="w-16 h-16 text-slate-300 mx-auto mb-4" />
                                        <h3 className="text-xl font-semibold text-slate-600">Henüz Analiz Yok</h3>
                                        <p className="text-slate-400 mt-2 mb-6">Öğrencilerin kompozisyonlarını yükleyerek başlayın.</p>
                                        <button 
                                            onClick={() => setActiveTab('upload')}
                                            className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                                        >
                                            İlk Analizi Yap
                                        </button>
                                    </div>
                                ) : (
                                    students.map((student) => (
                                        <StudentResultCard key={student.id} student={student} onDelete={deleteStudent} />
                                    ))
                                )}
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        function StudentResultCard({ student, onDelete }) {
            const [expanded, setExpanded] = useState(false);

            return (
                <div className="bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden transition-all hover:shadow-lg">
                    {/* Summary Header */}
                    <div 
                        onClick={() => setExpanded(!expanded)}
                        className="p-5 flex items-center justify-between cursor-pointer hover:bg-slate-50 transition-colors"
                    >
                        <div className="flex items-center space-x-4">
                            <div className="w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold text-lg">
                                {student.totalScore}
                            </div>
                            <div>
                                <h3 className="font-bold text-lg text-slate-800">{student.name}</h3>
                                <p className="text-sm text-slate-500">{student.topic} • {student.timestamp}</p>
                            </div>
                        </div>

                        <div className="flex items-center space-x-6">
                            <div className="hidden md:flex space-x-2">
                                <ScoreBadge label="Yazım" score={student.scores.grammar} />
                                <ScoreBadge label="Yapı" score={student.scores.structure} />
                                <ScoreBadge label="İçerik" score={student.scores.content} />
                            </div>
                            {expanded ? <Icons.ChevronUp className="text-slate-400" /> : <Icons.ChevronDown className="text-slate-400" />}
                        </div>
                    </div>

                    {/* Expanded Details */}
                    {expanded && (
                        <div className="border-t border-slate-100 bg-slate-50/30 p-6">
                            <div className="grid md:grid-cols-2 gap-8">
                                
                                <div className="space-y-6">
                                    <div>
                                        <h4 className="font-semibold text-slate-800 mb-3 flex items-center">
                                            <Icons.Award className="w-4 h-4 mr-2 text-indigo-500" />
                                            Detaylı Puanlama
                                        </h4>
                                        <div className="space-y-3">
                                            <ProgressBar label="Yazım Kuralları ve İmla" score={student.scores.grammar} />
                                            <ProgressBar label="Kompozisyon Yapısı" score={student.scores.structure} />
                                            <ProgressBar label="İçeriğe Uygunluk" score={student.scores.content} />
                                        </div>
                                    </div>

                                    <div className="bg-indigo-50 p-4 rounded-lg border border-indigo-100">
                                        <h4 className="font-semibold text-indigo-900 mb-2 text-sm uppercase tracking-wide">Öğretmen Asistanı Notu</h4>
                                        <p className="text-indigo-800 text-sm leading-relaxed">
                                            {student.feedback}
                                        </p>
                                    </div>

                                    <div className="pt-4 flex justify-end">
                                        <button 
                                            onClick={(e) => { e.stopPropagation(); onDelete(student.id); }}
                                            className="flex items-center text-red-500 hover:text-red-700 text-sm font-medium transition-colors"
                                        >
                                            <Icons.Trash2 size={16} className="mr-1" />
                                            Kaydı Sil
                                        </button>
                                    </div>
                                </div>

                                <div className="space-y-4">
                                    <h4 className="font-semibold text-slate-800 flex items-center">
                                        <Icons.FileText className="w-4 h-4 mr-2 text-indigo-500" />
                                        Dijitalleştirilmiş Metin (OCR)
                                    </h4>
                                    <div className="bg-white p-4 rounded-lg border border-slate-200 text-sm text-slate-600 italic leading-relaxed h-64 overflow-y-auto shadow-inner">
                                        {student.ocrText || "Metin okunamadı."}
                                    </div>
                                    
                                    <div className="mt-2">
                                        <span className="text-xs font-semibold text-slate-500 uppercase">Orijinal Belge</span>
                                        <img src={student.image} alt="Original Essay" className="mt-2 w-full h-32 object-cover rounded-lg opacity-80 hover:opacity-100 transition-opacity cursor-zoom-in" />
                                    </div>
                                </div>

                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function ScoreBadge({ label, score }) {
            let colorClass = "bg-slate-100 text-slate-600";
            if (score === 5) colorClass = "bg-green-100 text-green-700 font-bold";
            else if (score >= 3) colorClass = "bg-blue-50 text-blue-700";
            else colorClass = "bg-orange-50 text-orange-700";

            return (
                <div className={`px-3 py-1 rounded-md text-xs flex flex-col items-center border border-transparent ${colorClass}`}>
                    <span className="text-[10px] uppercase opacity-70">{label}</span>
                    <span className="text-sm">{score}/5</span>
                </div>
            );
        }

        function ProgressBar({ label, score }) {
            return (
                <div>
                    <div className="flex justify-between text-sm mb-1">
                        <span className="text-slate-600 font-medium">{label}</span>
                        <span className="text-slate-900 font-bold">{score}/5</span>
                    </div>
                    <div className="h-2 bg-slate-200 rounded-full overflow-hidden">
                        <div 
                            className="h-full bg-indigo-500 rounded-full transition-all duration-500"
                            style={{ width: `${(score / 5) * 100}%` }}
                        ></div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
